{"ast":null,"code":"import axios from 'axios';\nimport authHeader from './auth.headers';\nimport { API_URL, REFRESH_ENDPOINT } from './auth.constants';\n\n/**\n * Create an Axios Client with defaults\n */\nconst client = axios.create({\n  baseURL: API_URL\n});\nclient.interceptors.response.use(response => response, error => {\n  const originalRequest = error.config;\n\n  // Prevent infinite loops\n  if (error.response.status === 401 && originalRequest.url === API_URL + REFRESH_ENDPOINT) {\n    window.location.href = '/login/';\n    return Promise.reject(error);\n  }\n  if (error.response.data.code === \"token_not_valid\" && error.response.status === 401 && error.response.statusText === \"Unauthorized\") {\n    const user = localStorage.getItem('user');\n    if (user) {\n      const tokenParts = JSON.parse(atob(user.refresh.split('.')[1]));\n\n      // exp date in token is expressed in seconds, while now() returns milliseconds:\n      const now = Math.ceil(Date.now() / 1000);\n      console.log(tokenParts.exp);\n      if (tokenParts.exp > now) {\n        return client.post(REFRESH_ENDPOINT, {\n          refresh: user.refresh\n        }).then(response => {\n          localStorage.setItem('user', response.data);\n          client.defaults.headers['Authorization'] = \"Bearer \" + response.data.access;\n          originalRequest.headers['Authorization'] = \"Bearer \" + response.data.access;\n          return client(originalRequest);\n        }).catch(err => {\n          console.log(err);\n        });\n      } else {\n        console.log(\"Refresh token is expired\", tokenParts.exp, now);\n        window.location.href = '/login/';\n      }\n    } else {\n      console.log(\"Refresh token not available.\");\n      window.location.href = '/login/';\n    }\n  }\n\n  // specific error handling done elsewhere\n  return Promise.reject(error);\n});\n\n/**\n * Request Wrapper with default success/error actions\n */\nconst request = opts => {\n  let options = {\n    ...opts,\n    headers: authHeader()\n  };\n  const onSuccess = response => {\n    console.debug('Request Successful!', response);\n    return response;\n  };\n  const onError = error => {\n    console.error('Request Failed:', error.config);\n    if (error.response) {\n      // Request was made but server responded with something\n      // other than 2xx\n      console.error('Status:', error.response.status);\n      console.error('Data:', error.response.data);\n      console.error('Headers:', error.response.headers);\n    } else {\n      // Something else happened while setting up the request\n      // triggered the error\n      console.error('Error Message:', error.message);\n    }\n    return Promise.reject(error.response || error.message);\n  };\n  return client(options).then(onSuccess).catch(onError);\n};\nexport default request;","map":{"version":3,"names":["axios","authHeader","API_URL","REFRESH_ENDPOINT","client","create","baseURL","interceptors","response","use","error","originalRequest","config","status","url","window","location","href","Promise","reject","data","code","statusText","user","localStorage","getItem","tokenParts","JSON","parse","atob","refresh","split","now","Math","ceil","Date","console","log","exp","post","then","setItem","defaults","headers","access","catch","err","request","opts","options","onSuccess","debug","onError","message"],"sources":["/workspace/golf-app-frontend/frontend/src/services/api.request.js"],"sourcesContent":["import axios from 'axios'\nimport authHeader from './auth.headers';\nimport { API_URL, REFRESH_ENDPOINT } from './auth.constants';\n\n/**\n * Create an Axios Client with defaults\n */\nconst client = axios.create({\n  baseURL: API_URL,\n});\n\nclient.interceptors.response.use(\n  response => response,\n  error => {\n    const originalRequest = error.config;\n\n    // Prevent infinite loops\n    if (error.response.status === 401 && originalRequest.url === API_URL + REFRESH_ENDPOINT) {\n      window.location.href = '/login/';\n      return Promise.reject(error);\n    }\n\n    if (error.response.data.code === \"token_not_valid\" &&\n      error.response.status === 401 &&\n      error.response.statusText === \"Unauthorized\") {\n      const user = localStorage.getItem('user');\n\n      if (user) {\n        const tokenParts = JSON.parse(atob(user.refresh.split('.')[1]));\n\n        // exp date in token is expressed in seconds, while now() returns milliseconds:\n        const now = Math.ceil(Date.now() / 1000);\n        console.log(tokenParts.exp);\n\n        if (tokenParts.exp > now) {\n          return client\n            .post(REFRESH_ENDPOINT, { refresh: user.refresh })\n            .then((response) => {\n\n              localStorage.setItem('user', response.data);\n\n              client.defaults.headers['Authorization'] = \"Bearer \" + response.data.access;\n              originalRequest.headers['Authorization'] = \"Bearer \" + response.data.access;\n\n              return client(originalRequest);\n            })\n            .catch(err => {\n              console.log(err)\n            });\n        } else {\n          console.log(\"Refresh token is expired\", tokenParts.exp, now);\n          window.location.href = '/login/';\n        }\n      } else {\n        console.log(\"Refresh token not available.\")\n        window.location.href = '/login/';\n      }\n    }\n\n\n    // specific error handling done elsewhere\n    return Promise.reject(error);\n  }\n);\n\n\n/**\n * Request Wrapper with default success/error actions\n */\nconst request = (opts) => {\n  let options = {\n    ...opts,\n    headers: authHeader(),\n  }\n\n  const onSuccess = (response) => {\n    console.debug('Request Successful!', response);\n    return response;\n  }\n\n  const onError = (error) => {\n    console.error('Request Failed:', error.config);\n\n    if (error.response) {\n      // Request was made but server responded with something\n      // other than 2xx\n      console.error('Status:', error.response.status);\n      console.error('Data:', error.response.data);\n      console.error('Headers:', error.response.headers);\n\n    } else {\n      // Something else happened while setting up the request\n      // triggered the error\n      console.error('Error Message:', error.message);\n    }\n\n    return Promise.reject(error.response || error.message);\n  }\n\n  return client(options)\n    .then(onSuccess)\n    .catch(onError);\n}\n\nexport default request;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}