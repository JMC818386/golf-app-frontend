{"ast":null,"code":"import _objectSpread from\"/workspace/golf-app-frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import axios from'axios';import authHeader from'./auth.headers';import{API_URL,REFRESH_ENDPOINT}from'./auth.constants';/**\n * Create an Axios Client with defaults\n */const client=axios.create({baseURL:API_URL});client.interceptors.response.use(response=>response,error=>{const originalRequest=error.config;// Prevent infinite loops\nif(error.response.status===401&&originalRequest.url===API_URL+REFRESH_ENDPOINT){window.location.href='/login/';return Promise.reject(error);}if(error.response.data.code===\"token_not_valid\"&&error.response.status===401&&error.response.statusText===\"Unauthorized\"){const user=localStorage.getItem('user');if(user){const tokenParts=JSON.parse(atob(user.refresh.split('.')[1]));// exp date in token is expressed in seconds, while now() returns milliseconds:\nconst now=Math.ceil(Date.now()/1000);console.log(tokenParts.exp);if(tokenParts.exp>now){return client.post(REFRESH_ENDPOINT,{refresh:user.refresh}).then(response=>{localStorage.setItem('user',response.data);client.defaults.headers['Authorization']=\"Bearer \"+response.data.access;originalRequest.headers['Authorization']=\"Bearer \"+response.data.access;return client(originalRequest);}).catch(err=>{console.log(err);});}else{console.log(\"Refresh token is expired\",tokenParts.exp,now);window.location.href='/login/';}}else{console.log(\"Refresh token not available.\");window.location.href='/login/';}}// specific error handling done elsewhere\nreturn Promise.reject(error);});/**\n * Request Wrapper with default success/error actions\n */const request=opts=>{let options=_objectSpread(_objectSpread({},opts),{},{headers:authHeader()});const onSuccess=response=>{console.debug('Request Successful!',response);return response;};const onError=error=>{console.error('Request Failed:',error.config);if(error.response){// Request was made but server responded with something\n// other than 2xx\nconsole.error('Status:',error.response.status);console.error('Data:',error.response.data);console.error('Headers:',error.response.headers);}else{// Something else happened while setting up the request\n// triggered the error\nconsole.error('Error Message:',error.message);}return Promise.reject(error.response||error.message);};return client(options).then(onSuccess).catch(onError);};export default request;","map":{"version":3,"names":["axios","authHeader","API_URL","REFRESH_ENDPOINT","client","create","baseURL","interceptors","response","use","error","originalRequest","config","status","url","window","location","href","Promise","reject","data","code","statusText","user","localStorage","getItem","tokenParts","JSON","parse","atob","refresh","split","now","Math","ceil","Date","console","log","exp","post","then","setItem","defaults","headers","access","catch","err","request","opts","options","_objectSpread","onSuccess","debug","onError","message"],"sources":["/workspace/golf-app-frontend/frontend/src/services/api.request.js"],"sourcesContent":["import axios from 'axios'\nimport authHeader from './auth.headers';\nimport { API_URL, REFRESH_ENDPOINT } from './auth.constants';\n\n/**\n * Create an Axios Client with defaults\n */\nconst client = axios.create({\n  baseURL: API_URL,\n});\n\nclient.interceptors.response.use(\n  response => response,\n  error => {\n    const originalRequest = error.config;\n\n    // Prevent infinite loops\n    if (error.response.status === 401 && originalRequest.url === API_URL + REFRESH_ENDPOINT) {\n      window.location.href = '/login/';\n      return Promise.reject(error);\n    }\n\n    if (error.response.data.code === \"token_not_valid\" &&\n      error.response.status === 401 &&\n      error.response.statusText === \"Unauthorized\") {\n      const user = localStorage.getItem('user');\n\n      if (user) {\n        const tokenParts = JSON.parse(atob(user.refresh.split('.')[1]));\n\n        // exp date in token is expressed in seconds, while now() returns milliseconds:\n        const now = Math.ceil(Date.now() / 1000);\n        console.log(tokenParts.exp);\n\n        if (tokenParts.exp > now) {\n          return client\n            .post(REFRESH_ENDPOINT, { refresh: user.refresh })\n            .then((response) => {\n\n              localStorage.setItem('user', response.data);\n\n              client.defaults.headers['Authorization'] = \"Bearer \" + response.data.access;\n              originalRequest.headers['Authorization'] = \"Bearer \" + response.data.access;\n\n              return client(originalRequest);\n            })\n            .catch(err => {\n              console.log(err)\n            });\n        } else {\n          console.log(\"Refresh token is expired\", tokenParts.exp, now);\n          window.location.href = '/login/';\n        }\n      } else {\n        console.log(\"Refresh token not available.\")\n        window.location.href = '/login/';\n      }\n    }\n\n\n    // specific error handling done elsewhere\n    return Promise.reject(error);\n  }\n);\n\n\n/**\n * Request Wrapper with default success/error actions\n */\nconst request = (opts) => {\n  let options = {\n    ...opts,\n    headers: authHeader(),\n  }\n\n  const onSuccess = (response) => {\n    console.debug('Request Successful!', response);\n    return response;\n  }\n\n  const onError = (error) => {\n    console.error('Request Failed:', error.config);\n\n    if (error.response) {\n      // Request was made but server responded with something\n      // other than 2xx\n      console.error('Status:', error.response.status);\n      console.error('Data:', error.response.data);\n      console.error('Headers:', error.response.headers);\n\n    } else {\n      // Something else happened while setting up the request\n      // triggered the error\n      console.error('Error Message:', error.message);\n    }\n\n    return Promise.reject(error.response || error.message);\n  }\n\n  return client(options)\n    .then(onSuccess)\n    .catch(onError);\n}\n\nexport default request;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}